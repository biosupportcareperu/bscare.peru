<section class="py-12">
  <div class="container mx-auto px-4">
    <!-- Section Title -->
    <h2 class="section-title text-center">{{ section.settings.title }}</h2>
    {% if section.settings.subtitle != blank %}
      <p class="section-subtitle text-center max-w-2xl mx-auto">
        {{ section.settings.subtitle }}
      </p>
    {% endif %}
    
    <!-- Products Grid -->
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 md:gap-6">
      {% for product in collections[section.settings.collection].products limit: section.settings.products_to_show %}
        <div class="product-card relative group overflow-hidden rounded-lg bg-white shadow hover:shadow-md transition-shadow">
          <!-- Product Image -->
          <a href="{{ product.url }}">
            <div class="aspect-square overflow-hidden">
              {% if product.featured_image %}
                <img 
                  src="{{ product.featured_image | img_url: '300x300', crop: 'center' }}" 
                  alt="{{ product.title }}" 
                  class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
                >
              {% else %}
                <div class="w-full h-full bg-gray-200 flex items-center justify-center">
                  <i class="fa-solid fa-image text-gray-400 text-3xl"></i>
                </div>
              {% endif %}
            </div>
          </a>
          
          <!-- Product Details -->
          <div class="p-3">
            <a href="{{ product.url }}" class="block">
              <h3 class="text-sm font-medium text-gray-800 mb-1 truncate">{{ product.title }}</h3>
            </a>
            <div class="flex justify-between items-center">
              <span class="text-sm font-semibold text-gray-900">
                {{ product.price | money }}
              </span>
              
              <!-- Add to Cart Button (+ symbol) -->
              <button 
                class="add-to-cart"
                onclick="addToCart('{{ product.variants.first.id }}', 1, event)"
              >
                <i class="fa-solid fa-plus text-xs"></i>
              </button>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
    
    <!-- View All Link -->
    {% if section.settings.show_view_all %}
      <div class="text-center mt-8">
        <a href="/collections/{{ section.settings.collection }}" class="btn-primary">
          {{ 'collections.general.view_all' | t }}
        </a>
      </div>
    {% endif %}
  </div>
</section>

<script>
  function addToCart(variantId, quantity, event) {
    event.preventDefault();
    
    fetch('/cart/add.js', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        id: variantId,
        quantity: quantity
      })
    })
    .then(response => response.json())
    .then(data => {
      // Refresh cart drawer or show confirmation
      window.location.reload();
    })
    .catch(error => {
      console.error('Error:', error);
    });
  }
</script>

{% schema %}
{
  "name": "Product Grid",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Wellness products"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "Browse our bestselling orthopedic products"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 3,
      "max": 24,
      "step": 3,
      "default": 6,
      "label": "Number of products to show"
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "label": "Show 'View all' button",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Product Grid",
      "category": "Products"
    }
  ]
}
{% endschema %}